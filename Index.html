<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Everyday Preferences Assessment</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', system-ui, sans-serif; }
        .heading { font-family: 'Space Grotesk', sans-serif; }
        .option { transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        .option:hover { background-color: #1f2937; transform: translateX(4px); }
        .question-card { transition: all 0.3s ease; }
    </style>
</head>
<body class="bg-zinc-950 text-zinc-200 min-h-screen">
    <div class="max-w-2xl mx-auto px-6 py-12">
        <div class="text-center mb-12">
            <div class="inline-flex items-center gap-3 mb-2">
                <div class="w-9 h-9 bg-emerald-600 rounded-2xl flex items-center justify-center text-xl">ðŸ“‹</div>
                <h1 class="heading text-5xl font-semibold tracking-tighter text-white">Everyday Preferences Assessment</h1>
            </div>
            <p class="text-zinc-400 text-lg">A brief survey about common daily choices and habits</p>
            <p class="text-xs text-zinc-500 mt-3">Questions generated live using OpenAI</p>
        </div>

        <div class="text-center mb-10">
            <button onclick="generateQuestions()" 
                    class="bg-emerald-600 hover:bg-emerald-500 px-12 py-5 rounded-3xl font-semibold text-lg transition">
                Start Assessment
            </button>
            <p class="text-xs text-zinc-500 mt-4">Click to generate your unique set of questions</p>
        </div>

        <div id="loading" class="hidden text-center py-20">
            <div class="inline-flex flex-col items-center">
                <div class="w-8 h-8 border-4 border-zinc-700 border-t-emerald-500 rounded-full animate-spin mb-6"></div>
                <p class="text-zinc-400">Generating questions...</p>
            </div>
        </div>

        <div id="quizContainer" class="hidden">
            <form id="quizForm" class="space-y-8"></form>
            <div class="mt-12 flex justify-center">
                <button onclick="submitQuiz()" 
                        class="bg-white text-zinc-900 hover:bg-zinc-100 px-16 py-5 rounded-3xl font-semibold text-lg transition">
                    Complete Assessment
                </button>
            </div>
        </div>

        <div id="result" class="hidden mt-16 bg-zinc-900 border border-zinc-700 rounded-3xl p-12 text-center">
            <div class="mb-8">
                <div id="resultEmoji" class="text-7xl mb-4"></div>
                <h2 id="resultTitle" class="heading text-4xl font-semibold text-white"></h2>
            </div>
            <div class="mb-10">
                <div class="text-6xl font-mono font-bold text-emerald-400" id="scoreDisplay">0/20</div>
                <p class="text-zinc-400 text-sm tracking-widest uppercase">Preference Alignment Score</p>
            </div>
            <div id="resultText" class="text-zinc-300 text-lg leading-relaxed max-w-md mx-auto"></div>
            <div class="mt-12 pt-8 border-t border-zinc-700">
                <button onclick="location.reload()" 
                        class="bg-zinc-800 hover:bg-zinc-700 px-8 py-4 rounded-2xl text-sm font-medium">
                    Start Over
                </button>
            </div>
        </div>
    </div>

    <script>
        const API_KEY = "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";

        const SYSTEM_PROMPT = `You are an expert quiz designer creating a serious "Everyday Preferences Assessment".

Generate EXACTLY 10 multiple-choice questions.
Each must sound neutral, professional, and focused on ordinary daily life (weekend activities, music, events, career interests, friends, routines, social behavior, home environment, emotional responses, personality perception).

For each question:
- Exactly 3 options
- Hidden values: 0 = practical/low-maintenance, 1 = average/balanced, 2 = highly aesthetic/expressive/detail-oriented

Output ONLY a valid JSON array like this (nothing else):
[
  {
    "number": 1,
    "question": "On a typical free Saturday...",
    "options": [
      {"text": "Option A", "value": 0},
      {"text": "Option B", "value": 1},
      {"text": "Option C", "value": 2}
    ]
  }
  // exactly 9 more
]`;

        async function generateQuestions() {
            document.getElementById('loading').classList.remove('hidden');

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: "gpt-4o-mini",
                        messages: [
                            { role: "system", content: SYSTEM_PROMPT },
                            { role: "user", content: "Generate the 10 questions now. Output only the raw JSON array, no markdown, no explanation." }
                        ],
                        temperature: 0.7,
                        max_tokens: 1800
                    })
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                let text = data.choices[0].message.content.trim();

                // Clean possible markdown
                if (text.includes('```')) {
                    text = text.split('```')[1]?.replace('json', '').trim() || text;
                }

                const questions = JSON.parse(text);

                if (!Array.isArray(questions) || questions.length !== 10) {
                    throw new Error('Invalid format from API');
                }

                renderQuestions(questions);
            } catch (err) {
                console.error(err);
                alert("Failed to generate questions. Check console for details (or your API key/credits).");
                document.getElementById('loading').classList.add('hidden');
            }
        }

        function renderQuestions(questions) {
            const form = document.getElementById('quizForm');
            form.innerHTML = '';

            questions.forEach((q, i) => {
                const card = document.createElement('div');
                card.className = 'question-card bg-zinc-900 border border-zinc-700 rounded-3xl p-8';
                card.innerHTML = `
                    <div class="flex items-start gap-5">
                        <div class="w-8 h-8 bg-zinc-800 text-emerald-400 rounded-2xl flex items-center justify-center font-mono text-lg shrink-0">${q.number}</div>
                        <div class="flex-1">
                            <p class="text-lg leading-tight">${q.question}</p>
                            <div class="mt-7 space-y-3">
                                ${q.options.map(opt => `
                                    <label class="option flex items-center gap-4 bg-zinc-800 border border-transparent hover:border-zinc-600 rounded-2xl px-6 py-5 cursor-pointer">
                                        <input type="radio" name="q${i}" value="${opt.value}" class="w-5 h-5 accent-emerald-500">
                                        <span>${opt.text}</span>
                                    </label>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                `;
                form.appendChild(card);
            });

            document.getElementById('loading').classList.add('hidden');
            document.getElementById('quizContainer').classList.remove('hidden');
            window.scrollTo({ top: 400, behavior: 'smooth' });
        }

        function submitQuiz() {
            let score = 0;
            let answered = 0;

            for (let i = 0; i < 10; i++) {
                const radios = document.getElementsByName(`q${i}`);
                for (let r of radios) {
                    if (r.checked) {
                        score += parseInt(r.value);
                        answered++;
                        break;
                    }
                }
            }

            if (answered < 10) {
                alert("Please answer all questions.");
                return;
            }

            document.getElementById('scoreDisplay').textContent = `${score}/20`;

            let title, text, emoji;

            if (score <= 6) {
                title = "Practical & Grounded";
                text = "Your daily preferences emphasize functionality, efficiency, and straightforward approaches.";
                emoji = "âš™ï¸";
            } else if (score <= 13) {
                title = "Balanced & Versatile";
                text = "You demonstrate a well-rounded mix of practical and more expressive tendencies.";
                emoji = "âš–ï¸";
            } else {
                title = "Aesthetic & Expressive";
                text = "Your choices reflect strong attention to aesthetics, detail, emotional nuance, and personal presentation.";
                emoji = "ðŸŒŸ";
            }

            document.getElementById('resultEmoji').textContent = emoji;
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultText').innerHTML = text;

            document.getElementById('quizContainer').classList.add('hidden');
            document.getElementById('result').classList.remove('hidden');
            window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
        }
    </script>
</body>
</html>
